:ruby
  excluded_categories = local_assigns[:excluded_categories].presence
  chart_options = {
    params: { filters: detail_params },
    columns: columns,
    categories: categories,
    options: {
      height: chart_height,
      follow_link: show_client_details?,
      link_base: 'performance_dashboards/overview/details',
      key: key,
      sub_keys: sub_keys,
      date_ranges: {
        report: {
          start_date: @report.start_date,
          end_date: @report.end_date,
        },
        comparison: {
          start_date: @comparison.start_date,
          end_date: @comparison.end_date,
        }
      }
    }
  }

.d-flex.flex-wrap.justify-content-between.mb-2{class: @report_variant == 'sparse' ? 'align-items-baseline' : 'align-items-end'}
  %header.mb-2.ml-auto{style: 'flex: 1; min-width: 300px'}
    %h2
      - if @breakdown_section_title
        = [key.to_s.titleize, @breakdown_section_title].compact.join(': ')
      - elsif key == :enrolled && @report_variant == 'sparse'
        Actively Enrolled Clients from #{@report.date_range_words}
      - else
        = key.to_s.titleize
    .description= desc
    - if excluded_categories.present?
      .my-2
        %span.text-color-hl-prs1 Note:
        We do not show data that were explicitly excluded from your universe settings.
      %div
        .font-weight-bold.small.mb-1 Currently excluding:
        %ul.list-inline.d-inline
          - excluded_categories.each do |cat|
            %li.list-inline-item.chip-v1-prs1= cat
  .mb-2.ml-3
    - if @report_variant == 'sparse'
      .gray.lead.font-weight-normal
        - if @report.include_comparison?
          .mb-1.small.font-weight-bold Unique #{key.to_s.titleize} Clients
          .mb-1
            Reporting Period:
            = link_to_if show_client_details?,
              number_with_delimiter(client_counts[:report]),
              details_performance_dashboards_overview_index_path({ filters: detail_params }),
              data: {loads_in_pjax_modal: true},
              class: 'font-weight-bold'
          %div
            Comparison Period:
            = link_to_if show_client_details?,
              number_with_delimiter(client_counts[:comparison]),
              details_performance_dashboards_overview_index_path({ filters: comparison_params }),
              data: {loads_in_pjax_modal: true},
              class: 'font-weight-bold'
        - else
          Unique #{key.to_s.titleize} Clients
          = link_to_if show_client_details?,
            number_with_delimiter(client_counts[:report]),
            details_performance_dashboards_overview_index_path({ filters: detail_params }),
            data: {loads_in_pjax_modal: true},
            class: 'font-weight-bold'
    - else
      .d-flex.mb-2
        .report-period.mr-6
          %h4.m-0 Report Period
          %p.mb-0 #{@report.date_range_words}
          - count = client_counts[:report]
          = link_to_if show_client_details?, "Total Unique Clients: #{number_with_delimiter count}", details_performance_dashboards_overview_index_path({ filters: detail_params }), data: {loads_in_pjax_modal: true}
        - if @report.include_comparison?
          .comparison-period
            %h4.m-0 Comparison Period
            %p.mb-0 #{@comparison.date_range_words}
            - count = client_counts[:comparison]
            = link_to_if show_client_details?, "Total Unique Clients: #{number_with_delimiter count}", details_performance_dashboards_overview_index_path({ filters: comparison_params }), data: {loads_in_pjax_modal: true}

.well.mb-6.pt-0
  .jChart.c-chart.c-chart--horizontal-bar{ class: chart_class, data: { chart: chart_options.to_json.html_safe } }
