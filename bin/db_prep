#!/usr/bin/env ruby

# This is used to bootstrap local dev environments and to bootstrap
# brand new staging/production databases

require 'pathname'
require 'fileutils'

# path to your application root.
APP_ROOT = Pathname.new File.expand_path('..', __dir__)

Dir.chdir APP_ROOT do
  puts "\n== Preparing Database =="
  system 'bundle exec rake db:create'
  system 'bundle exec rake db:schema:conditional_load'
  system 'bundle exec rake db:migrate'

  puts "\n== Preparing Warehouse =="
  system 'bundle exec rake warehouse:db:create'
  system 'bundle exec rake warehouse:db:schema:conditional_load'
  system 'bundle exec rake warehouse:db:migrate'
  system 'bundle exec rake grda_warehouse:seed_data_sources'

  puts "\n== Preparing Health Database =="
  system 'bundle exec rake health:db:create'
  system 'bundle exec rake health:db:schema:conditional_load'
  system 'bundle exec rake health:db:migrate'

  puts "\n== Preparing Reporting Database =="
  system 'bundle exec rake reporting:db:create'
  system 'bundle exec rake reporting:db:schema:conditional_load'
  system 'bundle exec rake reporting:db:migrate'

  puts "\n== Seeding Database =="
  system 'bundle exec rake db:seed'
  system 'bundle exec rake grda_warehouse:seed_grades'
end
