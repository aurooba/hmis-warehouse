%h1 Hello world from all neighbors system report show
- start_date = (DateTime.current - 3.years).beginning_of_month
- end_date = DateTime.current.beginning_of_month
- all_data = AllNeighborsSystemDashboard::HousingTotalPlacementsData.new(start_date, end_date)
- total_data = all_data.total_data
- donut_data = all_data.donut_data
%input.all-neighbors__housing-placements__date-picker{id: 'all-neighbors__housing-placements__start-date', type: 'text', value: start_date.strftime("%b %Y")}
%input.all-neighbors__housing-placements__date-picker{id: 'all-neighbors__housing-placements__end-date', type: 'text', value: end_date.strftime("%b %Y")}
#all-neighbors__housing-placements__total-placements
.row
  - donut_data.each do |d|
    .col-6
      %h5= d[:title]
      %div{id: "all-neighbors__housing-placements__#{d[:id]}"}

- content_for :page_js do
  :javascript
    $(document).ready(function() {
      var totalData = #{total_data.to_json.html_safe}
      
      var donutData = #{donut_data.to_json.html_safe}

      var startDate = '#{start_date.to_s}'
      var endDate = '#{end_date.to_s}'
      
      var line = new AllNeighborsSystemDashboardLine(
        totalData,
        {projectType: 'All', countLevel: 'Individuals', dateRange: [Date.parse(startDate), Date.parse(endDate)]},
        '#all-neighbors__housing-placements__total-placements'
      )
      line.test()
      line.draw()

      console.log('donutData', donutData)

      donutData.forEach(function(d) {
        var donut = new AllNeighborsSystemDashboardDonut(
          d.data,
          {dateRange: [Date.parse(startDate), Date.parse(endDate)]},
          '#all-neighbors__housing-placements__'+d.id
        )
        console.log('Donut', d.title)
        donut.test()
        donut.draw()
      })

    })

-#
  - content_for :page_js do
    :javascript
      $(document).ready(function() {

        var startDatepicker = $('#all-neighbors__housing-placements__start-date').datepicker({
            format: 'M yyyy',
            startDate: '#{start_date.strftime("%b %Y")}',
            endDate: '#{end_date.strftime("%b %Y")}',
            startView: 'months',
            minViewMode: 'months'
          })
        var endDatepicker = $('#all-neighbors__housing-placements__end-date').datepicker({
            format: 'M yyyy',
            startDate: '#{start_date.strftime("%b %Y")}',
            endDate: '#{end_date.strftime("%b %Y")}',
            startView: 'months',
            minViewMode: 'months'
          })
        startDatepicker.on('changeDate', function(e) {
          console.log('e', e)
          console.log('this', this)
          var endDate = $('#all-neighbors__housing-placements__end-date').datepicker("getDate")
          console.log('endDatepicker value', endDate)
          totalPlacements.load({
            columns: [
              xColumns(e.date, endDate),
              totalColumns(e.date, endDate)
            ]
          })
        })
      })