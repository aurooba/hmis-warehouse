.well.internal-chart-wrapper{ class: ["internal-#{active_stack}-by-#{active_x}-wrapper", hidden_class, "stack-#{active_stack}", "x-axis-#{active_x}"], data: { stack: active_stack, x_axis: active_x } }
  %h2.mb-4= title
  .d-flex
    .chart.d-flex{style: 'width: 70%;'}
      %div{ id: "internal-#{active_stack}-by-#{active_x}-chart", style: 'width: 100%;' }
    .actions.ml-4{style: 'width: 20%;'}
      .action-buttons.d-flex.mb-4
        .dropdown.internal-stack-dropdown
          %button.btn.btn-secondary.btn-sm.dropdown-toggle{ type: :button, data: { toggle: :dropdown}, aria: { expanded: :false }} Demographic
          .dropdown-menu
            - [:race, :ethnicity].each do |item|
              - classes = []
              - classes << 'active' if active_stack == item || active_x == item
              %a.dropdown-item{ href: '#', class: classes, data: { axis: :stack, value: item} }= item.to_s.humanize
        .dropdown.ml-4.internal-x-axis-dropdown
          %button.btn.btn-secondary.btn-sm.dropdown-toggle{ type: :button, data: { toggle: :dropdown}, aria: { expanded: :false }} Group
          .dropdown-menu
            - [:stages, :cohorts].each do |item|
            - classes = []
              - classes << 'active' if active_x == item || active_stack == item
              %a.dropdown-item{ href: '#', class: classes, data: { axis: :x_axis, value: item} }= item.to_s.humanize
        %button.btn.btn-secondary.btn-sm.internal-axis-swap.ml-2 Swap Axes

      .mt-12{ id: "internal-#{active_stack}-by-#{active_x}-legend" }

= content_for :page_js do
  :javascript
    let internal_#{active_stack}_by_#{active_x} = #{@report.public_send(data_method).to_json.html_safe};
    window.charts = window.charts || {}
    window.charts.internal_#{active_stack}_by_#{active_x}_chart = bb.generate({
      'data': internal_#{active_stack}_by_#{active_x},
      'bindto': "#internal-#{active_stack}-by-#{active_x}-chart",
      bar: {
        padding: 20,
        width: 105,
      },
      size: {
        height: 500,
      },
      axis: {
        x: {
          type: 'category',
        },
        y: {
          tick: {
            values: [0, 100],
          }
        },
      },

      legend: {
        contents: {
          bindto: '#internal-#{active_stack}-by-#{active_x}-legend',
          template: "<div class='d-flex mr-auto text-left'><div class='mr-2 mt-2 mb-0 ml-0' style='padding:5px; height: 14px; width: 26px; background-color:{=COLOR}; border-radius: 10px; '>&nbsp;</div><div class='ml-0 mr-auto mt-1 mb-1'>{=TITLE}</div></div>"
        }
      }
    });
