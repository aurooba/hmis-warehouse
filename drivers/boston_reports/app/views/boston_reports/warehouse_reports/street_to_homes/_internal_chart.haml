%div{ class: ["internal-#{active_stage}-by-#{active_x}-wrapper"] }
  %h2= title
  .d-flex
    .chart.d-flex{style: 'width: 70%;'}
      %div{ id: "internal-#{active_stage}-by-#{active_x}-chart" }
    .actions.ml-4{style: 'width: 20%;'}
      .action-buttons.d-flex.mb-4
        .dropdown.iternal-stack-dropdown
          %button.btn.btn-secondary.btn-sm.dropdown-toggle{ type: :button, data: { toggle: :dropdown}, aria: { expanded: :false }} Stack
          .dropdown-menu
            %a.dropdown-item{ href: '#', class: if active_stage == :race then 'active' end } Race
            %a.dropdown-item{ href: '#' } Ethnicity
            %a.dropdown-item{ href: '#' } Stages
            %a.dropdown-item{ href: '#' } Cohorts
        .dropdown.ml-4.iternal-x-axis-dropdown
          %button.btn.btn-secondary.btn-sm.dropdown-toggle{ type: :button, data: { toggle: :dropdown}, aria: { expanded: :false }} X-Axis
          .dropdown-menu
            %a.dropdown-item{ href: '#' } Race
            %a.dropdown-item{ href: '#' } Ethnicity
            %a.dropdown-item{ href: '#', class: if active_x == :stages then 'active' end } Stages
            %a.dropdown-item{ href: '#' } Cohorts
      .mt-auto{ id: "internal-#{active_stage}-by-#{active_x}-legend" }

= content_for :page_js do
  :javascript
    let internal_#{active_stage}_by_#{active_x} = #{@report.public_send(data_method).to_json.html_safe};
    let internal_#{active_stage}_by_#{active_x}_chart = bb.generate({
      'data': internal_#{active_stage}_by_#{active_x},
      'bindto': "#internal-#{active_stage}-by-#{active_x}-chart",
      bar: {
        padding: 20,
        width: 105,
      },
      size: {
        height: 500,
      },
      axis: {
        x: {
          type: 'category',
        },
        y: {
          tick: {
            values: [0, 100],
          }
        },
      },

      legend: {
        contents: {
          bindto: '#internal-#{active_stage}-by-#{active_x}-legend',
          template: "<div class='d-flex mr-auto text-left'><div class='mr-2 mt-2 mb-0 ml-0' style='padding:5px; height: 14px; width: 26px; background-color:{=COLOR}; border-radius: 10px; '>&nbsp;</div><div class='ml-0 mr-auto mt-1 mb-1'>{=TITLE}</div></div>"
        }
      }
    });
