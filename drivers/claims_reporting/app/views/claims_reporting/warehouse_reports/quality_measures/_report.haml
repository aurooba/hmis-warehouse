:ruby
  markdown = Redcarpet::Markdown.new(::TranslatedHtml)
  measures = ClaimsReporting::QualityMeasuresReport::AVAILABLE_MEASURES
  years = ['2018', '2019', '2020']
  reports = years.map do |year|
    ClaimsReporting::QualityMeasures.for_plan_year(year, user: current_user)
  end
  f = ClaimsReporting::Formatter.new
  # By ACO - claims data
  # My Patients
  # Race/Gender/Age?
  # <del>subpopulations
.row
  .col-12
    .pb-4
      %h3 MassHealth BH CP Quality Measures
      %table.table.table-sm.table-bordered.table-striped
        %thead
          %tr
            %th
              Measure
            - years.each_with_index do |year, idx|
              - report = reports[idx]
              %th
                %div{data: {toggle: :tooltip, title: "Created at: #{report.created_at}. #{report.status}"} }= "PY#{year}"
        - measures.each do |measure_id, info|
          %tr
            %td
              %b= info.title
              = raw markdown.render(info.desc) if info.desc
            - reports.each do |report|
              - data = report.measure_value(measure_id).with_indifferent_access
              %td
                - if data[:value].blank?
                  = "-"
                - elsif data[:denominator]
                  .h3
                    %div= f.format_pct(data[:value] * 100.0)
                    - if data[:denominator].present?
                      %small.text-muted.text-nowrap
                        %span{data: {toggle: :tooltip, title: info.numerator}}
                          =  f.format_i(data[:numerator])
                        = "/"
                        %span{data: {toggle: :tooltip, title: info.denominator}}
                          = f.format_i(data[:denominator])
                - else
                  = f.format_d(data[:value])
